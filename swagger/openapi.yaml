openapi: 3.0.3
info:
  title: Meta Webhook Processor API
  description: |
    This API processes webhooks from Meta platforms (Facebook Messenger, Instagram, and WhatsApp) and Telegram.
    It receives webhook events, extracts relevant data, and forwards structured messages to Kafka.
  version: 1.0.0
  contact:
    name: API Support
    url: https://webhook.iamsairam.in

servers:
  - url: https://webhook.iamsairam.in
    description: Production Webhook Server
  - url: https://service.iamsairam.in
    description: Production Service Server

paths:
  /webhook/messenger:
    post:
      tags:
        - Webhooks
      summary: Messenger Webhook
      description: Receives webhook events from Facebook Messenger
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MessengerWebhook'
            example:
              object: "page"
              entry:
                - id: "PAGE_ID"
                  messaging:
                    - sender:
                        id: "USER_ID"
                      recipient:
                        id: "PAGE_ID"
                      message:
                        text: "Hello"
      responses:
        '200':
          description: Webhook received successfully
          content:
            text/plain:
              schema:
                type: string
                example: "messenger Webhook received!"

  /webhook/instadm:
    post:
      tags:
        - Webhooks
      summary: Instagram Webhook
      description: Receives webhook events from Instagram Direct Messages
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MessengerWebhook'
      responses:
        '200':
          description: Webhook received successfully
          content:
            text/plain:
              schema:
                type: string
                example: "instadm Webhook received!"

  /webhook/whatsapp:
    post:
      tags:
        - Webhooks
      summary: WhatsApp Webhook
      description: Receives webhook events from WhatsApp Business API
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/WhatsAppWebhook'
            example:
              object: "whatsapp_business_account"
              entry:
                - id: "BUSINESS_ID"
                  changes:
                    - value:
                        messages:
                          - from: "USER_PHONE"
                            id: "MESSAGE_ID"
                            text:
                              body: "Hello"
      responses:
        '200':
          description: Webhook received successfully
          content:
            text/plain:
              schema:
                type: string
                example: "whatsapp Webhook received!"

  /webhook/telegram/{botToken}:
    post:
      tags:
        - Webhooks
      summary: Telegram Webhook
      description: Receives webhook events from Telegram Bot API
      parameters:
        - name: botToken
          in: path
          required: true
          schema:
            type: string
          description: Telegram bot token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TelegramWebhook'
      responses:
        '200':
          description: Webhook received successfully
          content:
            text/plain:
              schema:
                type: string
                example: "telegram Webhook received!"

components:
  schemas:
    MessengerWebhook:
      type: object
      properties:
        object:
          type: string
          example: "page"
        entry:
          type: array
          items:
            $ref: '#/components/schemas/MessengerEntry'

    MessengerEntry:
      type: object
      properties:
        id:
          type: string
        messaging:
          type: array
          items:
            $ref: '#/components/schemas/MessengerMessage'

    MessengerMessage:
      type: object
      properties:
        sender:
          $ref: '#/components/schemas/User'
        recipient:
          $ref: '#/components/schemas/User'
        message:
          $ref: '#/components/schemas/MessageContent'

    WhatsAppWebhook:
      type: object
      properties:
        object:
          type: string
          example: "whatsapp_business_account"
        entry:
          type: array
          items:
            $ref: '#/components/schemas/WhatsAppEntry'

    WhatsAppEntry:
      type: object
      properties:
        id:
          type: string
        changes:
          type: array
          items:
            $ref: '#/components/schemas/WhatsAppChange'

    WhatsAppChange:
      type: object
      properties:
        value:
          $ref: '#/components/schemas/WhatsAppValue'

    WhatsAppValue:
      type: object
      properties:
        messages:
          type: array
          items:
            $ref: '#/components/schemas/WhatsAppMessage'

    WhatsAppMessage:
      type: object
      properties:
        from:
          type: string
        id:
          type: string
        text:
          $ref: '#/components/schemas/WhatsAppText'

    WhatsAppText:
      type: object
      properties:
        body:
          type: string

    TelegramWebhook:
      type: object
      properties:
        update_id:
          type: integer
        message:
          $ref: '#/components/schemas/TelegramMessage'

    TelegramMessage:
      type: object
      properties:
        message_id:
          type: integer
        from:
          $ref: '#/components/schemas/TelegramUser'
        chat:
          $ref: '#/components/schemas/TelegramChat'
        text:
          type: string

    TelegramUser:
      type: object
      properties:
        id:
          type: integer
        is_bot:
          type: boolean
        first_name:
          type: string
        username:
          type: string

    TelegramChat:
      type: object
      properties:
        id:
          type: integer
        type:
          type: string
        first_name:
          type: string

    User:
      type: object
      properties:
        id:
          type: string

    MessageContent:
      type: object
      properties:
        text:
          type: string
        attachments:
          type: array
          items:
            $ref: '#/components/schemas/Attachment'

    Attachment:
      type: object
      properties:
        type:
          type: string
        payload:
          type: object
          properties:
            url:
              type: string